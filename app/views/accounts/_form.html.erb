<%= form_with model: account, class: "space-y-6" do |f| %>
  <% if account.errors.any? %>
    <div class="alert-danger">
      <div class="flex-1">
        <h3 class="font-semibold mb-2">Please fix the following errors:</h3>
        <ul class="space-y-1">
          <% account.errors.full_messages.each do |message| %>
            <li class="flex items-start gap-2">
              <svg class="w-4 h-4 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
              </svg>
              <%= message %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div>
    <%= f.label :name, class: "form-label" %>
    <%= f.text_field :name, class: "form-input", placeholder: "e.g., Main Checking" %>
  </div>

  <div>
    <%= f.label :account_type, class: "form-label" %>
    <%= f.select :account_type, [["Checking", "checking"], ["Savings", "savings"]], {}, class: "form-select" %>
  </div>

  <div>
    <%= f.label :current_balance, class: "form-label" %>
    <%= f.number_field :current_balance, step: 0.01, value: (sprintf('%.2f', account.current_balance.to_f) if account.current_balance.present?), class: "form-input", placeholder: "0.00" %>
    <p class="form-hint">Your verified balance from your bank</p>
  </div>

  <div>
    <%= f.label :balance_date, "Balance As Of Date", class: "form-label" %>
    <%= f.date_field :balance_date, id: "account_balance_date", class: "form-input" %>
    <p class="form-hint">When was this balance last verified?</p>
    <script>
      // Set to browser's local date if empty (avoids UTC timezone mismatch)
      (function() {
        var field = document.getElementById('account_balance_date');
        if (field && !field.value) {
          var today = new Date();
          var yyyy = today.getFullYear();
          var mm = String(today.getMonth() + 1).padStart(2, '0');
          var dd = String(today.getDate()).padStart(2, '0');
          field.value = yyyy + '-' + mm + '-' + dd;
        }
      })();
    </script>
  </div>

  <div>
    <%= f.label :warning_threshold, "Warning Threshold", class: "form-label" %>
    <%= f.number_field :warning_threshold, step: 0.01, value: (sprintf('%.2f', account.warning_threshold.to_f) if account.warning_threshold.present?), class: "form-input", placeholder: "500.00" %>
    <p class="form-hint">Show warning when projected balance drops below this amount</p>
  </div>

  <div class="flex justify-end gap-3 pt-4 border-t border-neutral-200">
    <%= design_button "Cancel", accounts_path, variant: :secondary %>
    <%= f.submit class: "btn-primary cursor-pointer" %>
  </div>
<% end %>
