<div class="space-y-6">
  <%# Page Header %>
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
    <div>
      <h1 class="text-2xl font-display font-bold text-neutral-900"><%= @account.name %></h1>
      <p class="text-sm text-neutral-500"><%= @account.account_type.titleize %> Account</p>
    </div>
    <div class="flex items-center gap-2">
      <%= link_to "Edit", edit_account_path(@account), class: "btn-secondary btn-sm" %>
      <%= link_to "Back", accounts_path, class: "text-neutral-500 hover:text-neutral-700 text-sm" %>
    </div>
  </div>

  <%# Balance Summary %>
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
    <div class="card p-6">
      <p class="text-sm font-medium text-neutral-500">Current Balance</p>
      <p class="mt-2 text-3xl font-display font-bold text-neutral-900">$<%= money_amount(@account.current_balance) %></p>
      <p class="text-xs text-neutral-400 mt-1">as of <%= @account.balance_date.strftime("%b %d, %Y") %></p>
    </div>
    <div class="card p-6">
      <p class="text-sm font-medium text-neutral-500">Projected Balance (<%= @settings.default_view_months %>mo)</p>
      <% projected = @account.projected_balance %>
      <p class="mt-2 text-3xl font-display font-bold <%= projected >= 0 ? 'text-success-600' : 'text-danger-600' %>">
        $<%= money_amount(projected) %>
      </p>
      <p class="text-xs text-neutral-400 mt-1"><%= (projected - @account.current_balance) >= 0 ? '+' : '' %>$<%= money_amount((projected - @account.current_balance).abs) %> change</p>
    </div>
    <div class="card p-6">
      <p class="text-sm font-medium text-neutral-500">Transactions</p>
      <p class="mt-2 text-3xl font-display font-bold text-neutral-900"><%= @transactions.count %></p>
      <p class="text-xs text-neutral-400 mt-1">in projection window</p>
    </div>
  </div>

  <%# Transaction List %>
  <div class="card overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h2 class="text-lg font-display font-semibold text-neutral-900">Transactions</h2>
    </div>

    <%# Mobile Transaction Cards %>
    <div class="sm:hidden divide-y divide-neutral-200">
      <% running_balance_mobile = @account.current_balance %>
      <% @transactions.each do |txn| %>
        <% running_balance_mobile += txn.amount %>
        <div class="p-4 <%= txn.estimated? ? 'bg-warning-50/30' : '' %>">
          <%# Row 1: Status, Date, Amount %>
          <div class="flex items-center justify-between gap-2">
            <div class="flex items-center gap-3">
              <% if txn.estimated? %>
                <%= badge "EST", variant: :warning %>
              <% else %>
                <%= badge "ACT", variant: :success %>
              <% end %>
              <span class="text-sm font-medium text-neutral-600"><%= txn.date.strftime("%b %d") %></span>
            </div>
            <span class="text-money font-semibold <%= txn.amount >= 0 ? 'text-success-600' : 'text-danger-600' %>">
              <%= txn.formatted_amount %>
            </span>
          </div>

          <%# Row 2: Description %>
          <div class="mt-2">
            <div class="font-semibold text-neutral-900"><%= txn.description %></div>
          </div>

          <%# Row 3: Balance %>
          <div class="mt-2 text-sm">
            <span class="text-neutral-500">Bal:</span>
            <span class="text-money font-medium <%= running_balance_mobile >= 0 ? 'text-neutral-900' : 'text-danger-600' %>">
              $<%= money_amount(running_balance_mobile) %>
            </span>
          </div>
        </div>
      <% end %>
    </div>

    <%# Desktop Table %>
    <div class="hidden sm:block">
      <table class="data-table">
        <thead>
          <tr>
            <th>Status</th>
            <th>Date</th>
            <th>Description</th>
            <th class="text-right">Amount</th>
            <th class="text-right">Balance</th>
          </tr>
        </thead>
        <tbody>
          <% running_balance = @account.current_balance %>
          <% @transactions.each do |txn| %>
            <% running_balance += txn.amount %>
            <tr class="<%= txn.estimated? ? 'bg-warning-50/30' : '' %>">
              <td>
                <% if txn.estimated? %>
                  <%= badge "EST", variant: :warning %>
                <% else %>
                  <%= badge "ACT", variant: :success %>
                <% end %>
              </td>
              <td class="text-neutral-900">
                <%= txn.date.strftime("%b %d, %Y") %>
              </td>
              <td class="text-neutral-900">
                <%= txn.description %>
              </td>
              <td class="text-right">
                <%= format_money(txn.amount) %>
              </td>
              <td class="text-right text-money <%= running_balance >= 0 ? 'text-neutral-900' : 'text-danger-600 font-semibold' %>">
                $<%= money_amount(running_balance) %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <% if @transactions.empty? %>
      <div class="px-6 py-8 text-center text-neutral-500">
        No transactions for this account
      </div>
    <% end %>
  </div>
</div>
